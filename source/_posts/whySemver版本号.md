---
title: SemVer? 起版本号当然要讲些规矩 
date: 2019-05-26 22:12:11
tags: [开发杂记]
categories: [开发杂记]
---

## 什么是SemVer？ 

最近吴大佬的科普下， 简单了解了一些SemVer语义化版本号的规范， 准备在这里记录和总结一些自己的想法。 

首先， 我们来看一下前端React框架最近发布的版本号的命名。 

* v16.9.0-alpha.0
* v16.8.6
* v16.8.5
* v16.8.4
* v16.8.3
* v16.8.2
* v16.8.1
* v16.8.0
* v16.8.0-alpha.1
* v16.7.0

可以看出 React 发布的版本是非常的清晰和规范的, 这就归功于Semver(语义化的版本)规范的功劳, 从中咱们不难可以总结出一些规律。 

1. 软件的版本通常由三位组成， 形如： X. Y. Z， 依照Semver规范， 版本格式： 主版本号. 次版本号. 修订号， 版本号递增规则如下： 

> * 主版本号： 当你做了不兼容的 API 修改
> * 次版本号： 当你做了向下兼容的功能性新增 
> * 修订号： 当你做了向下兼容的问题修正。 

2. 版本是严格递增的， 例如React此处是： 16.8.5 -> 16.8.6-> 16.9.0

3. 在发布重要版本时， 可以发布alpha、 rc等先行版本

> 先行版本号及版本编译元数据可以加到“主版本号. 次版本号. 修订号”的后面， 作为延伸。 

以上的三点基本可以概括Semver规范所要求的版本号格式了， 具体的一些细则可以参考 [https://semver.org/lang/zh-CN/](https://semver.org/lang/zh-CN/)

## 版本号而已为啥会有Semver？ 

在我的理解中， SemVer就是一套规定了版本号应该如何去表示， 如何增加， 如何进行比较， 不同的版本号意味着什么的规范。 

也许在我们以往的认识中， 版本号是一个很随意的存在， 而判断它需不需要进位的依据仅仅是”我觉得差不多可以了改个版本了“。 

然而当我们的项目变得庞大起来时， 往往需要分包或者依赖于一些其他的软件包。 软件包是会不断更新和变化的， 这时就存在了不同软件包版本之间的依赖关系， 一旦管理不慎， 很容易出现有一些bug的情况， 例如A包需要依赖B包的一个新功能， 但当前的B包过久无法提供， 软件包之间无法完成相互的依赖。 

如今的前端项目， 打开我们的 `package.json` 文件， 我们甚至能找到几十个甚至上百个依赖的包。 而这很可能只是冰山一角， 还有许许多多依赖的依赖包。 于是忽， 如何更好的管理和规范这些包的版本， 让其统一便于理解和使用成为了一个问题。 

因此， Github 起草了一个具有指导意义的， 统一的版本号表示规则， 称为 Semantic Versioning(语义化版本表示)。 

## 有啥好处举个栗子？ 

讲了很多大道理，不如我们举个例子来看看语义化后的版本如何让依赖地狱成为过去2333～。 

* 首先， 我们假设有位 `”消防员“` ， 他参与救火任务时需要依赖 `”梯子“` 去攀爬。 
* `消防员` 平时训练时要使用"梯子"第三代第一版时新增的功能( `消防员` 依赖于 `梯子 v3.1.0` )
* 于是， 在日后的救火任务中 `消防员` 可以放心的去使用版本号大等于 `v3.1.0` 但小于 `v4.0.0` 的梯子(出现不可兼容更新， 主版本号递增， 无法保证原有的功能特性可以兼容)
* 同时， 当有>= `3.1.1` ~< `3.2.0` 版本的 `梯子` 发布时， `消防员` 可以毫无顾虑， 无需学习就可使用， 因为这些梯子只是原有基础上的一些小修整(修订号更新无新功能添加， 仅为bugfix)

哈哈哈， 上面这个例子应该可以很好理解了吧。 由此可以看出， SemVer大大的规范了软件包之间的版本发布， 你甚至不用去了解更新的具体内容， 就可以决定是否需要更新到特定版本的软件包。 

## 在package.json中的运用( `^~*x` )

当执行 `npm install package -S` 或 `yarn add` 来安装三方包时， 包管理器会首先安装包的最新版本， 然后将包名及版本号写入到 package.json 文件中。 

我们可以对依赖包的版本号做一些修改来限定依赖包的版本范围。 例如:

* 兼容模块新发布的修订补丁版本： ~16.2.0、 16.2.x、 16.2， 只有修订版本的更新会被匹配。 
* 兼容模块新发布的小版本、 修订补丁版本： ^16.2.0、 16.x、 16， 小版本及修订版本的更新会被匹配。 
* 兼容模块新发布的大版本、 小版本、 修订补丁版本： *、 x， 所有的版本都会被比配。 

